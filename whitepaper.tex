\documentclass{article}
\usepackage[utf8]{inputenc}

\title{\texttt{perf} in Rust}
\author{Timothy Maloney}
\date{Summer 2021}

\begin{document}

\maketitle
\section*{Abstract}
\pagebreak
\section{Introduction to \texttt{perf}}
Per the wiki, "\texttt{perf} is a profiler tool for linux-based systems that abstracts away CPU hardware differences in Linux performance measurements and presents a simple command-line interface." There are numerous \texttt{perf} sub-commands to analyze performance and trace data. \texttt{perf} is very similar to \texttt{git}; There is a generic tool \texttt{perf} that
implements a set of commands.
\section{Events and Environments}
Events in this context are simply asynchronous actions that are external to the currently executing environment. The executing environment can be specified on a per-thread, per-process, per-cpu, or system-wide basis; e.g. in per-thread mode, the performance counters are only measured during execution of a designated thread. 
\\\\
\texttt{perf} has a list of measurable events. There are effectively four types of events:
\begin{itemize}
    \item \textbf{Software Events}
    \item \textbf{Hardware PMU Events}
    \item \textbf{Hardware Cache Events}
    \item \textbf{Tracepoint Events}
\end{itemize}
\subsection{Event Selection}
It is important to consider the events to be measured and distinguish their types. The scope of events we measure and their types are described via the following table:
\begin{center}
    \begin{tabular}{|c|c|}
        \hline
        \textbf{Event} & \textbf{Type}  \\
        \hline
         cpu-cycles & Hardware\\
         instructions & Hardware\\
         L1-dcache-loads & Hardware cache\\
         L1-dcache-load-misses & Hardware cache\\
         context-switches & Software\\
         page faults & Software\\
         cpu-clock & Software\\
         task-clock & Software\\
    \hline
    \end{tabular}
\end{center}
\pagebreak
\subsection{Environment Selection}
%% per-thread/per-process/per-cpu %%
\section{QEMU Virtual Machine}
The decision to use QEMU as a virtual machine is because performance counters are hardware-specific, and everyone in our group uses a different machine. The machine used in this project is the q35 chip, which was specified by using the \texttt{-machine type=q35} option when starting a QEMU virtual machine. %% TODO: SPECIFY MACHINE %% 
\pagebreak
\section{\texttt{perf stat}}
\subsection{Introduction}
A very useful \verb|perf| command is \verb|stat|. More clearly, \texttt{perf stat <command>} executes \texttt{command} and gathers performance counter statistics associated with it. Performance counters are registers that store the counts of hardware-related activities. As an example, this command:
\\\\
\centerline{\texttt{perf stat dd if=/dev/zero of=/dev/null count=1000000}}
\\\\
has the following (partial) output:
\\\\
\texttt{..}\\
\centerline{\texttt{ 5,099 cache-misses \hspace{5mm} \# \hspace{5mm} 0.005 M/sec (scaled from 66.58\%)}}\\
\texttt{..}
\\\\
So, during the execution of \verb|dd..| there were 5,099 total cache misses, with one miss occurring every 5 milliseconds.
One or more events may be measured by using the \texttt{-e} flag and their designated name. It is important to note that by default events are measured at both user and kernel levels. This can also be modified by specifying either the \texttt{-u} flag or the \texttt{-k} flag. e.g. Only checking cache misses that occurred during command execution at the user level looks like:
\\\\
\centerline{\texttt{perf stat -e cache-misses:u dd..}}
\\\\
\subsection{Output}
\section{\texttt{perf test}}
\section{Testing}
\pagebreak
\section{References}
Eranian, Stephane, et al. “Main Page.” Perf Wiki, Kernel.org,
\\perf.wiki.kernel.org/index.php/Main\_Page.
\end{document}
